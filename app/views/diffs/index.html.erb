<% title @title %>

<%= render 'admin/filter_by_buyer' if @buyers %>
<%= render 'buyer/filter_by_search' %>

<%= will_paginate @entries  %>
<%= page_info @entries %>

<% unless @entries.blank? %>
<table id="diff">
	<thead>
    <%= content_tag :th, 'Vehicle', :class => 'vehicle' %>
		<th class="">
	    <%= content_tag :div, 'Part Description', :class => 'part' %>
	    <%= content_tag :div, 'Diff Computations', :class => 'amounts' %>
		</th>
	</thead>
	<% @entries.each do |entry| %>
	<tr>
		<td class="vehicle">	
			<%= content_tag :p, entry.ref_no %>
			<%= content_tag :p, truncate(entry.vehicle) %>
			<p><%= entry.plate_no %> <%= content_tag :abbr, "by #{entry.user.username}", :class => 'highlight'  %></p>
			<%= content_tag :h4, "First Bid: " + distance_of_time_in_words(entry.created_at, entry.bids.order(:bid_speed).first.created_at) unless entry.bids.blank? %>
			<%#= active_diff_mark(entry) %>
			<%= link_to 'Compute Diff', diff_path(entry) %>
		</td>
	  <td>
  	<% for line_item in entry.line_items %>
			<div class="part">
		    <%= content_tag :p, "[ #{line_item.quantity} ] " + line_item.part_name %>
				<%= content_tag :p, "TAT: " + distance_of_time_in_words(line_item.created_at, line_item.bids.first.created_at) unless line_item.bids.blank? %>
			</div>
			<div class="amounts">
	    <%= content_tag :div, 'E-Bid', :class => 'labels ebid' %>
			<% unless line_item.bids.blank? %>
			  <%= content_tag :div, admin_high_bid("original", line_item), :class => 'amount' %>
			  <%= content_tag :div, admin_high_bid("replacement", line_item), :class => 'amount' %>
			  <%= content_tag :div, admin_high_bid("surplus", line_item), :class => 'amount' %>
			  <%= content_tag :div, admin_low_bid("original", line_item), :class => 'amount' %>
			  <%= content_tag :div, admin_low_bid("replacement", line_item), :class => 'amount' %>
			  <%= content_tag :div, admin_low_bid("surplus", line_item), :class => 'amount' %>
			<% else %>
		    <%= content_tag :div, 'No Bids Submitted', :class => 'no-bid' %>
			<% end %>
	    <%= content_tag :div, 'Manual', :class => 'labels manual' %>
			<% unless line_item.diffs.blank? %>
			<%= content_tag :div, (render 'diffs/diff', :diff => line_item.last_diff("original")), :class => 'amount' %>
			<%= content_tag :div, (render 'diffs/diff', :diff => line_item.last_diff("replacement")), :class => 'amount' %>
			<%= content_tag :div, (render 'diffs/diff', :diff => line_item.last_diff("surplus")), :class => 'amount' %>
			<% end %>
			</div>
		<% end %>
		</td>                          
	</tr>
	<% end %>
</table>
<% end %>

<%= will_paginate @entries  %>
