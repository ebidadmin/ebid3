<% title @title %>

<%= render 'buyer/filter_by_user' unless current_user.has_role?('seller') || @user_group.nil? %>
<%#= render 'buyer/filter_by_status' unless @status_tags.nil? %>
<%= render 'buyer/filter_by_sellers' unless @sellers.blank? %>
<%= render 'buyer/filter_by_search' %>

<%= content_tag :h3, "Total: #{number_to_currency(@all_orders.collect(&:total_order_amounts).sum, :unit => "P ")}", :id => 'order-total' %>
<%= content_tag :p, "#{User.find(params[:seller]).company_name} only: #{number_to_currency(@search.collect(&:total_order_amounts).sum, :unit => "P ")}", :id => 'supplier-total', :class => 'strong highlight' unless params[:seller].nil? %>

<%= will_paginate @orders %>
<%= page_info @orders, @sort_order %>

<%- unless @orders.blank? -%>
<table id="print-payments-list">
	<thead>
    <%= content_tag :th, 'Vehicle' %>
    <%= content_tag :th, 'Order Items' %>
    <%= content_tag :th, 'PO Amount' %>
    <%= content_tag :th, 'Status', :class => 'stat' %>
	</thead>
	<% @orders.group_by(&:entry).each do |entry, orders| %>
	<tr>
		<td rowspan=<%= orders.count + 1 %>>	
			<%= content_tag :p, (entry.ref_no unless entry.ref_no.nil?)  %>
			<%= content_tag :h5, entry.vehicle %>
			<%= content_tag :span, entry.plate_no %>
			<%= content_tag :span, "(created by #{entry.user.username})", :class => 'highlight' %>
		</td>
	</tr>
	<% for order in orders %>
	<tr>
  	<td >	
 			<% for order_item in  order.order_items %>
				<%= content_tag :p, "[ #{order_item.quantity} ] " + order_item.line_item.part_name %>
			<% end %>
	 	</td>
		<td>
      <%= content_tag :h5, 'Total: ' + number_to_currency(order.order_total, :unit => "P ") %>
		  <%= link_to "View PO", order %>
		</td>
  	<td class='stat'>
  		<%= content_tag :p, 'Seller: ' + order.seller.profile.company.name, :class => 'instruction'  %>
			<%= content_tag :p, 'Delivered: ' + order.delivered.strftime('%b %d') unless order.delivered.nil? %>
			<%= payment_due_status_for_print(order) %>
		</td>
  </tr>
	<% end %>
	<% end %>
	<tr class="totals">
	  <td>Sub-Total</td>
	  <td></td>
	  <td><%= number_to_currency(@orders.collect(&:order_total).sum, :unit => "P ") %></td>
	  <td></td>
	</tr>
</table>
<%- end -%>

